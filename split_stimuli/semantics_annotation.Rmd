---
title: "Semantics Split Stimuli"
output: 
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F)
library(tidyverse)
library(scales)
#library(googleVis)
```

# About
This Markdown creates a number of graphs for the paper 'A Corpus-based Perspective on ‘Split Stimuli’ in German'. Not all of them are included in the paper.

## The data

NZZ_1998_03_16_a6_seg28_s1 excluded (annotation not possible because sentence is fragmentary due to sentence tokenisation error in original data).

```{r}
annotations <- read_csv("full_pp_annotation.csv", col_types = "fcdcfffcccccc") %>%
  mutate(interpr_sem_class_PP_int = if_else(is.na(interpr_sem_class_PP_int), # Fill the "gaps" that made annotation easier
                                                     sem_class_PP_int,
                                                     interpr_sem_class_PP_int))

# Fill gaps for determiner column
new_det_PP_int <- list()
for (i in 1:nrow(annotations)) {
  if(! is.na(annotations$det_PP_int[i])){
    if(str_starts(annotations$det_PP_int[i], "[/+]")){new_det_PP_int[i] <- str_c("norm", annotations$det_PP_int[i])}
    else 
      if(str_ends(annotations$det_PP_int[i], "[/+]")){new_det_PP_int[i] <- str_c(annotations$det_PP_int[i], "norm")}
      else {new_det_PP_int[i] <- annotations$det_PP_int[i]}}
  else 
    if(str_detect(annotations$interpr_sem_class_PP_int[i], "[/+]")){
    inner <- str_c(str_extract_all(annotations$interpr_sem_class_PP_int[i], "[//+]")[[1]], collapse = "norm")
    new_det_PP_int[i] <- str_c("norm", inner, "norm")
  }
  else new_det_PP_int[i] <- "norm"
}

annotations$new_det_PP_int <- as.character(new_det_PP_int)

annotations <- mutate(annotations,
                      sem_class_subj_f = factor(sem_class_subj),
                      sem_class_PP_int_f = factor(sem_class_PP_int),
                      interpr_sem_class_PP_int_f = factor(interpr_sem_class_PP_int),
                      det_PP_int_f = factor(new_det_PP_int),
                      utterance = if_else(str_detect(Comment_PP, coll("utterance")), T, F, missing = F),
                      popoart = if_else(str_detect(Comment_PP, coll("(part of) piece of art")), T, F, missing = F))

summary(annotations)

simple_cases <- filter(annotations, ! str_detect(interpr_sem_class_PP_int, "[/+]") & ! str_detect(sem_class_subj, "[/+]") & ! str_detect(sem_class_PP_int, "[/+]")) %>%
  droplevels()
```
## Overall overview by preposition

### Subjects

```{r}
colour_codes <- c("abstract_obj" = "purple", "abstract_obj,property" = "orange", "abstract_obj,concrete_obj" = "grey25", 
                  "abstract_obj,event" = "yellow2", "abstract_obj,event(action)" = "yellow4",
                  "ambiguous" = "black", "anim_proxy" = "darkgreen", "animal" = "green3", 
                  "event" = "red", "event(action)" = "darkred", "human" = "green",
                  "locative" = "gold2", "property" = "blue2", "concrete_obj" = "grey", "other" = "white")

colour_codes_subj <- c("abstract_obj" = "purple", "abstract_obj,property" = "orange",
                  "ambiguous" = "black", "anim_proxy" = "darkgreen", "animal" = "green3", 
                  "event" = "red", "event(action)" = "darkred", "human" = "green",
                  "property" = "blue2", "concrete_obj" = "grey", "other" = "white")

othervec <- names(summary(simple_cases$sem_class_subj_f))[summary(simple_cases$sem_class_subj_f) > 5]

prepositions_subjects_summary <- 
  simple_cases %>%
  mutate(sem_class_subj_f_short = if_else(sem_class_subj %in% othervec, sem_class_subj, "other")) %>%
  group_by(Stimulus_PP, sem_class_subj_f_short) %>% 
  summarise(count = n())


ggplot(prepositions_subjects_summary, aes(x = count, y = Stimulus_PP, fill = sem_class_subj_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Preposition", fill = "Subject") +
  theme(legend.position = "bottom", legend.key.size = unit(4, "pt")) +
  scale_fill_manual(values = colour_codes_subj)

ggplot(filter(prepositions_subjects_summary, as.character(Stimulus_PP) %in% c("bei", "in", "an", "durch", "mit", "als")), aes(x = count, y = Stimulus_PP, fill = sem_class_subj_f_short)) +
  geom_bar(stat = "identity", position = "fill") +
  labs(x = "Frequency", y = "Preposition", fill = "Subject") +
  theme(legend.position = "bottom", legend.key.size = unit(4, "pt")) +
  scale_fill_manual(values = colour_codes_subj)
```

### Interpretation

```{r}
colour_codes_inter <- c("abstract_obj" = "purple",
                  "abstract_obj,event" = "yellow2", "abstract_obj,event(action)" = "yellow4",
                  "ambiguous" = "black",
                  "event" = "red", "event(action)" = "darkred", "human" = "green",
                  "locative" = "gold2", "property" = "blue2", "concrete_obj" = "grey", "other" = "white")

othervec <- names(summary(simple_cases$interpr_sem_class_PP_int_f))[summary(simple_cases$interpr_sem_class_PP_int_f) > 5]

prepositions_int_summary <- 
  simple_cases %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec, interpr_sem_class_PP_int, "other")) %>%
  group_by(Stimulus_PP, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(prepositions_int_summary, aes(x = count, y = Stimulus_PP, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Prepositions", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)

ggplot(filter(prepositions_int_summary, as.character(Stimulus_PP) %in% c("bei", "in", "an", "durch", "mit", "als")), aes(x = count, y = Stimulus_PP, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "fill") +
  labs(x = "Share", y = "Prepositions", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Interpretation without Utterance and (Part of) Piece of art

```{r}
colour_codes_inter <- c("abstract_obj" = "purple",
                  "abstract_obj,event" = "yellow2", "abstract_obj,event(action)" = "yellow4",
                  "ambiguous" = "black",
                  "event" = "red", "event(action)" = "darkred", "human" = "green",
                  "locative" = "gold2", "property" = "blue2", "concrete_obj" = "grey", "other" = "white")

othervec <- names(summary(simple_cases$interpr_sem_class_PP_int_f))[summary(simple_cases$interpr_sem_class_PP_int_f) > 5]

prepositions_int_summary_without_u_pop <- 
  simple_cases %>%
  filter(! utterance, ! popoart) %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec, interpr_sem_class_PP_int, "other")) %>%
  group_by(Stimulus_PP, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(prepositions_int_summary_without_u_pop, aes(x = count, y = Stimulus_PP, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Prepositions", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)

ggplot(filter(prepositions_int_summary_without_u_pop, as.character(Stimulus_PP) %in% c("bei", "in", "an", "durch", "mit", "als")), aes(x = count, y = Stimulus_PP, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "fill") +
  labs(x = "Share", y = "Prepositions", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Det

Is the determiner missing although one would expect its presence naively? Is the determiner a pronoun coreferential with the subject?

```{r}
prepositions_det_summary <- 
  simple_cases %>%
  group_by(Stimulus_PP, det_PP_int_f) %>% 
  summarise(count = n())

ggplot(filter(prepositions_det_summary, as.character(Stimulus_PP) %in% c("bei", "in", "an", "durch", "mit", "als")), aes(x = count, y = Stimulus_PP, fill = det_PP_int_f)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Prepositions", fill = "Determiner") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt"))
```

### Utterance
With which subjects and PPs did we comment utterance?

```{r}
prepositions_ut_summary <- 
  simple_cases %>%
  group_by(Stimulus_PP, sem_class_subj_f, interpr_sem_class_PP_int_f, utterance) %>% 
  summarise(count = n()) %>%
  filter(utterance)

ggplot(prepositions_ut_summary, aes(x = count, y = sem_class_subj_f, fill = interpr_sem_class_PP_int_f)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_grid(rows = vars(Stimulus_PP))
  labs(x = "Frequency", y = "Prepositions", fill = "Determiner") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt"))
```

### (Part of) piece of art
With which subjects and PPs did we comment (part of) piece of art?

```{r, fig.height=20}
colour_codes_inter <- c("abstract_obj" = "purple",
                  "abstract_obj,event" = "yellow2", "abstract_obj,event(action)" = "yellow4",
                  "ambiguous" = "black", "event(action),abstract_obj" = "yellow3",
                  "event" = "red", "event(action)" = "darkred", "human" = "green",
                  "locative" = "gold2", "property" = "blue2", "concrete_obj" = "grey", "other" = "white")

othervec <- names(summary(simple_cases$interpr_sem_class_PP_int_f))[summary(simple_cases$interpr_sem_class_PP_int_f) > 5]

prepositions_pop_summary <- 
  simple_cases %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec, interpr_sem_class_PP_int, "other")) %>%
  group_by(Stimulus_PP, sem_class_subj_f, interpr_sem_class_PP_int_f_short, popoart) %>% 
  summarise(count = n()) %>%
  filter(popoart)

ggplot(prepositions_pop_summary, aes(x = count, y = sem_class_subj_f, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_grid(rows = vars(Stimulus_PP)) +
  labs(x = "Frequency", y = "Prepositions", fill = "Determiner") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

## Prepositions and verbs

We will also need information on the examples that don't contain a stimulus preposition here, so we have to read in the original GerEO annotations.

```{r}
list_file_names_csv <- list.files(path = "../annotations", pattern='*.csv')
list_file_names_csv <- map_chr(list_file_names_csv, function(x){str_glue("../annotations", x, .sep = "/")})

df_list_csv <- lapply(list_file_names_csv, read_csv2, show_col_types = F)
verben <- sapply(list_file_names_csv, str_sub, 16, -5)

names(df_list_csv) <- verben

df_csv <- bind_rows(df_list_csv, .id = "Verb") %>%
  select(1:27) # without Misc etc.

# creating one pattern column
for(i in 8:22){
  df_csv[,i] <- ifelse(is.na(df_csv[,i]), "", colnames(df_csv)[i])
}
df_all_verbs_cat <- unite(df_csv, pattern, 8:22, sep = "", remove = T)

# factorizing
df_all_verbs_cat$pattern <- factor(df_all_verbs_cat$pattern)
df_all_verbs_cat$Stimulus_Type <- factor(df_all_verbs_cat$Stimulus_Type)
df_all_verbs_cat$Stimulus_PP <- factor(df_all_verbs_cat$Stimulus_PP)
df_all_verbs_cat$Verb <- factor(df_all_verbs_cat$Verb)
df_all_verbs_cat$not_of_interest <- ifelse(is.na(df_all_verbs_cat$not_of_interest), F, T)
df_all_verbs_cat$`non-psych` <- ifelse(is.na(df_all_verbs_cat$`non-psych`), F, T)

# verb translations
# transl <- read_csv2("gloss_verbs.csv")
# 
# levels(df_all_verbs_cat$Verb) <- fct_relabel(levels(df_all_verbs_cat$Verb), function(x){str_c(x, ' "', str_sub(transl$Translation, 4), '"')})

only_spl_stm_relevant <- filter(df_all_verbs_cat, ! not_of_interest, ! `non-psych`,
                                pattern == "X-STM_V_Y-EXP" | pattern == "X-STM_V")

spl_verbsandpreps <- data.frame(verb = only_spl_stm_relevant$Verb, prep = only_spl_stm_relevant$Stimulus_PP)
# also exclude für, osa, über, von. Check of the few relevant examples showed that definitely not split stimuli (although one will keep the Stimulus_PP annotation)
spl_verbsandpreps$prep <- factor(ifelse(is.na(spl_verbsandpreps$prep) | spl_verbsandpreps$prep == "für" | spl_verbsandpreps$prep == "über" | spl_verbsandpreps$prep == "von", "none", as.character(spl_verbsandpreps$prep)))
spl_verbsandpreps$prep <- relevel(spl_verbsandpreps$prep, ref = "none")

ggplot(spl_verbsandpreps, aes(x = verb, fill = prep)) +
  geom_bar(position = "stack") +
  theme(axis.text.x = element_text(size = 8, angle = 55, vjust = 1, hjust = 1),
        legend.key.size = unit(0.2, 'cm'),
        legend.text = element_text(size = 11)) +
  scale_fill_manual(values = c("grey85", "red2", "red", "aquamarine",
                               "grey35", "pink", "black", "blue2",
                               "blue", "yellow", "yellow2", "orange2",
                               "magenta", "white", "lightgreen"))
```
```{r}
ggplot(spl_verbsandpreps, aes(y = verb, fill = prep)) +
  geom_bar(position = "stack") +
  theme_bw() +
  theme(legend.key.size = unit(0.3, 'cm'),
        legend.text = element_text(size = 8),
        legend.title = element_text(size = 8),
        legend.position = "top") +
  labs(x = NULL, y = NULL, fill = "Preposition") +
  geom_vline(aes(xintercept = 100)) +
  coord_trans(x = trans_new("overhunderedhalf", function(i){if_else(i <= 100, i, 100+(i-100)/6)}, function(i){if_else(i <= 100, i, 100+(i-100)*6)})) +
  scale_fill_manual(values = c("grey85", "red2", "red", "aquamarine",
                               "grey35", "pink", "black", "blue2",
                               "blue", "yellow", "yellow2", "orange2",
                               "magenta", "white", "lightgreen"))
                               
#ggsave("verbsandpreps_bars.png", device = "png", width = 11.8, height = 19, units = "cm")
```

```{r}
ggplot(spl_verbsandpreps, aes(y = verb, fill = prep)) +
  geom_bar(position = "stack") +
  theme_bw() +
  theme(legend.key.size = unit(0.3, 'cm'),
        legend.text = element_text(size = 8),
        legend.title = element_text(size = 8),
        legend.position = "top") +
  labs(x = NULL, y = NULL, fill = "Preposition") +
  geom_vline(aes(xintercept = 100)) +
  coord_trans(x = trans_new("overhunderedsixth", function(i){if_else(i <= 100, i, 100+(i-100)/6)}, function(i){if_else(i <= 100, i, 100+(i-100)*6)})) +
  scale_fill_manual(values = c("grey85",                          # none, all colour values except for this one from show_col(viridis_pal(option = "turbo")(12))
                                "#30123BFF", # als
                                "#7A0403FF", # als,mit
                               "#F1CA3AFF", # an
                               "#1FC8DEFF", # aufgrund
                               "#29EFA2FF", # bei
                               "#7DFF56FF", # dank
                               "#4454C4FF", # durch
                               "#4490FEFF", # durch,mit
                               "#FE922AFF", # in
                               "#EA4F0DFF", # in,mit
                               "#BE2102FF", # mit
                               "#C1F334FF", # ob
                               "white"))    # wegen
                               
#ggsave("verbsandpreps_bars_turbo.png", device = "png", width = 11.8, height = 19, units = "cm")
```

```{r}
counts_verbsandpreps <- group_by(spl_verbsandpreps, verb, prep) %>%
    summarise(count = n())
```

```{r}
ggplot(counts_verbsandpreps, aes(x = count, y = prep, fill = prep)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(vars(verb)) +
  labs(x = NULL, y = NULL) +
  theme_minimal() +
  theme(axis.text = element_text(size = 8),
        axis.text.x = element_text(angle = 90),
        strip.text = element_text(size = 8),
        strip.clip = "off") +
  scale_fill_viridis_d() +
  guides(fill = "none")

#ggsave("verbsandpreps_wrap.png", device = "png", width = 11.8, height = 19, units = "cm")
```

```{r}
ggplot(counts_verbsandpreps, aes(x = prep, y = verb)) +
  geom_point(aes(colour = prep, size = count), alpha = 0.8) +
  theme_bw() +
  labs(x = NULL, y = NULL, fill = NULL) +
  theme(axis.text.x = element_text(size = 8, angle = 55, vjust = 1, hjust = 1),
        legend.key.size = unit(0.2, 'cm'),
        legend.text = element_text(size = 11),
        legend.position = "bottom") +
  guides(colour = "none")

#ggsave("verbsandpreps_bubbles.png", device = "png", width = 11.8, height = 19, units = "cm")
```
```{r}
library(ggmosaic)

ggplot(spl_verbsandpreps) +
  geom_mosaic(aes(x = product(verb, prep), fill = prep))  +
  theme_bw() +
  theme(axis.text.x = element_text(size = 10, angle = 90, vjust = 0.25, hjust = 1),
        legend.text = element_text(size = 11)) +
  guides(fill = "none")

#ggsave("verbsandpreps_mosaic.png", device = "png", width = 11.8, height = 19, units = "cm")
```

## Durch

```{r}
durch_data_simple <- simple_cases %>%
  filter(Stimulus_PP == "durch")

durch_data_general <- annotations %>%
  filter(Stimulus_PP == "durch")

othervec_int_durch <- names(summary(durch_data_simple$interpr_sem_class_PP_int_f))[summary(durch_data_simple$interpr_sem_class_PP_int_f) > 2]
othervec_subj_durch <- names(summary(durch_data_simple$sem_class_subj_f))[summary(durch_data_simple$sem_class_subj_f) > 2]
othervec_PP_int_durch <- names(summary(durch_data_simple$sem_class_PP_int_f))[summary(durch_data_simple$sem_class_PP_int_f) > 2]
```

### Overview
```{r}
durch_overview_summary <- 
  durch_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_durch, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_durch, sem_class_subj, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_durch, if_else(sem_class_PP_int == "event(action),abstract_obj", "abstract_obj,event(action)", sem_class_PP_int), "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short, sem_class_PP_int_f_short) %>% 
  summarise(count = n()) %>%
  ungroup() %>%
  transmute(subject = factor(sem_class_subj_f_short),
            internal_argument = factor(sem_class_PP_int_f_short),
            interpretation_int_arg = factor(interpr_sem_class_PP_int_f_short),
            count = count) %>%
  pivot_longer(c(subject, internal_argument, interpretation_int_arg), names_to = "NP", values_to = "semantics") %>%
    group_by(NP, semantics) %>%
    summarise(share = sum(count)/nrow(durch_data_simple)) %>%
    mutate(semantics = factor(semantics, c("other", "ambiguous", "anim_proxy", 
                                           "human", "concrete_obj", "abstract_obj", 
                                           "abstract_obj,event", "abstract_obj,event(action)",
                                           "event(action)", "property")))

ggplot(durch_overview_summary, aes(x = NP, y = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = NULL, y = "share", fill = NULL) +
  theme(legend.position = "bottom", legend.key.size = unit(10, "pt")) +
  scale_fill_manual(values = colour_codes)

#ggsave("durch_overview.png", device = "png", width = 18.5, height = 11, units = "cm")
```

```{r}
ggplot(durch_overview_summary, aes(y = semantics, x = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "share", y = "Semantics", fill = NULL) +
  facet_wrap(vars(NP)) +
  theme_bw() +
  theme(strip.text = element_text(size = 8),
        strip.clip = "off",
        strip.background = element_rect(fill = "white", linewidth = 0),
        axis.text = element_text(size = 7)) +
  scale_fill_viridis_d() +
  guides(fill = "none") +
  scale_x_continuous(limits = c(0, 0.75))

#ggsave("durch_overview.png", device = "png", width = 11.5, height = 9, units = "cm")
```

### Utterance and (part of) piece of art
```{r}
durch_ut_popo_summary <- 
  durch_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_durch, interpr_sem_class_PP_int, "other"),
         ut_popoa = if_else(utterance & popoart, "utterance & (part of) piece of art",
                            if_else(utterance & ! popoart, "utterance",
                            if_else(! utterance & popoart, "(part of) piece of art",
                            " ")))) %>%
  group_by(interpr_sem_class_PP_int_f_short, ut_popoa) %>% 
  summarise(count = n())

ggplot(durch_ut_popo_summary, aes(x = interpr_sem_class_PP_int_f_short, y = count, fill = ut_popoa)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Interpr. int. arg.", y = "Frequency", fill = "Interpr. int. arg.") +
  theme(axis.text.x = element_text(angle = 90))
```


### Interpretation by subject
```{r}
durch_subj_int_summary <- 
  durch_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_durch, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_durch, sem_class_subj, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(durch_subj_int_summary, aes(x = count, y = sem_class_subj_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Subject", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Semantic class int. arg. and interpretation

```{r}
durch_PP_int_int_summary <- 
  durch_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_durch, interpr_sem_class_PP_int, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_durch, sem_class_PP_int, "other")) %>%
  group_by(sem_class_PP_int_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n()) 


ggplot(durch_PP_int_int_summary, aes(x = count, y = sem_class_PP_int_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "sem. class int. arg.", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)

sankey_durch_PP_int_int_summary <- durch_PP_int_int_summary %>%
  mutate(interpr_sem_class_PP_int_f_short = str_c("  ", interpr_sem_class_PP_int_f_short, sep = ""))

#plot(gvisSankey(sankey_durch_PP_int_int_summary, from = "sem_class_PP_int_f_short", to = "interpr_sem_class_PP_int_f_short", weight = "count", options = list(height = 400, width = 600, sankey = "{link: { colorMode: 'source'}, tooltip: { textStyle: { fontName: 'Linux Libertine O', fontSize: 12 } }, node: { label: { fontName: 'Linux Libertine O', fontSize: 12 }, nodePadding: 7, interactivity: false } }")))
```


### Interpretation per verb
```{r}
durch_int_verb_summary <- 
  durch_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_durch, interpr_sem_class_PP_int, "other")) %>%
  group_by(Verb, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(durch_int_verb_summary, aes(x = count, y = Verb, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Verb", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Interpretation int. arg. and Stimulus_Type per verb
```{r}
durch_int_PP_st_summary <- 
  durch_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_durch, interpr_sem_class_PP_int, "other")) %>%
  group_by(Verb, Stimulus_Type, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(durch_int_PP_st_summary, aes(x = count, y = Verb, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Verb", fill = "Interpr. int. arg.") +
  facet_grid(cols = vars(Stimulus_Type)) + 
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

## Mit

```{r}
mit_data_simple <- simple_cases %>%
  filter(Stimulus_PP == "mit")
mit_data_general <- annotations %>%
  filter(Stimulus_PP == "mit")

othervec_int_mit <- names(summary(mit_data_simple$interpr_sem_class_PP_int_f))[summary(mit_data_simple$interpr_sem_class_PP_int_f) > 5]
othervec_subj_mit <- names(summary(mit_data_simple$sem_class_subj_f))[summary(mit_data_simple$sem_class_subj_f) > 5]
othervec_PP_int_mit <- names(summary(mit_data_simple$sem_class_PP_int_f))[summary(mit_data_simple$sem_class_PP_int_f) > 5]
```

### Overview
```{r}
mit_overview_summary <- 
  mit_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_mit, 
                                                    if_else(interpr_sem_class_PP_int == "event(action),abstract_obj",
                                                            "abstract_obj,event(action)", interpr_sem_class_PP_int), 
                                                    "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_mit, sem_class_subj, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_mit, if_else(sem_class_PP_int == "event(action),abstract_obj", "abstract_obj,event(action)", sem_class_PP_int), "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short, sem_class_PP_int_f_short) %>% 
  summarise(count = n()) %>%
  ungroup() %>%
  transmute(subject = factor(sem_class_subj_f_short),
            internal_argument = factor(sem_class_PP_int_f_short),
            interpretation_int_arg = factor(interpr_sem_class_PP_int_f_short),
            count = count) %>%
  pivot_longer(c(subject, internal_argument, interpretation_int_arg), names_to = "NP", values_to = "semantics") %>%
    group_by(NP, semantics) %>%
    summarise(share = sum(count)/nrow(mit_data_simple)) %>%
    mutate(semantics = factor(semantics, c("other", "ambiguous", "anim_proxy", 
                                           "human", "concrete_obj", "abstract_obj", 
                                           "abstract_obj,event", "abstract_obj,event(action)",
                                           "event", "event(action)", "property")))

ggplot(mit_overview_summary, aes(x = NP, y = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = NULL, y = "Frequency", fill = NULL) +
  theme(legend.position = "bottom", legend.key.size = unit(10, "pt")) +
  scale_fill_manual(values = colour_codes)

#ggsave("mit_overview.png", device = "png", width = 18.5, height = 11, units = "cm")
```

```{r}
ggplot(mit_overview_summary, aes(y = semantics, x = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "share", y = "Semantics", fill = NULL) +
  facet_wrap(vars(NP)) +
  theme_bw() +
  theme(strip.text = element_text(size = 8),
        strip.clip = "off",
        strip.background = element_rect(fill = "white", linewidth = 0),
        axis.text = element_text(size = 7)) +
  scale_fill_viridis_d() +
  guides(fill = "none") +
  scale_x_continuous(limits = c(0, 0.75))

#ggsave("mit_overview.png", device = "png", width = 11.5, height = 9, units = "cm")
```


### Utterance and (part of) piece of art
```{r}
mit_ut_popo_summary <- 
  mit_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_mit, interpr_sem_class_PP_int, "other"),
         ut_popoa = if_else(utterance & popoart, "utterance & (part of) piece of art",
                            if_else(utterance & ! popoart, "utterance",
                            if_else(! utterance & popoart, "(part of) piece of art",
                            " ")))) %>%
  group_by(interpr_sem_class_PP_int_f_short, ut_popoa) %>% 
  summarise(count = n())

ggplot(mit_ut_popo_summary, aes(x = interpr_sem_class_PP_int_f_short, y = count, fill = ut_popoa)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Interpr. int. arg.", y = "Frequency", fill = NULL) +
  theme(axis.text.x = element_text(angle = 90))
```


### Interpretation by subject
```{r}
mit_subj_int_summary <- 
  mit_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_mit, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_mit, sem_class_subj, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(mit_subj_int_summary, aes(x = count, y = sem_class_subj_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Subject", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Semantic class int. arg. and interpretation

```{r}
mit_PP_int_int_summary <- 
  mit_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_mit, interpr_sem_class_PP_int, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_mit, sem_class_PP_int, "other")) %>%
  group_by(sem_class_PP_int_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(mit_PP_int_int_summary, aes(x = count, y = sem_class_PP_int_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Sem. class int. arg.", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)

sankey_mit_PP_int_int_summary <- mit_PP_int_int_summary %>%
  mutate(interpr_sem_class_PP_int_f_short = str_c("  ", interpr_sem_class_PP_int_f_short, sep = ""))

#plot(gvisSankey(sankey_mit_PP_int_int_summary, from = "sem_class_PP_int_f_short", to = "interpr_sem_class_PP_int_f_short", weight = "count", options = list(height = 400, width = 600, sankey = "{link: { colorMode: 'source'}, tooltip: { textStyle: { fontName: 'Linux Libertine O', fontSize: 12 } }, node: { label: { fontName: 'Linux Libertine O', fontSize: 12 }, nodePadding: 7, interactivity: false } }")))
```


### Interpretation per verb
```{r}
mit_int_verb_summary <- 
  mit_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_mit, interpr_sem_class_PP_int, "other")) %>%
  group_by(Verb, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(mit_int_verb_summary, aes(x = count, y = Verb, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Verb", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Interpretation int. arg. and Stimulus_Type per verb
```{r}
mit_int_PP_st_summary <- 
  mit_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_mit, interpr_sem_class_PP_int, "other")) %>%
  group_by(Verb, Stimulus_Type, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(mit_int_PP_st_summary, aes(x = count, y = Verb, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Verb", fill = "Interpr. int. arg.") +
  facet_grid(cols = vars(Stimulus_Type)) + 
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

## Als

```{r}
als_data_simple <- simple_cases %>%
  filter(Stimulus_PP == "als")

als_data_general <- annotations %>%
  filter(Stimulus_PP == "als")

othervec_int_als <- names(summary(als_data_simple$interpr_sem_class_PP_int_f))[summary(als_data_simple$interpr_sem_class_PP_int_f) > 0]
othervec_subj_als <- names(summary(als_data_simple$sem_class_subj_f))[summary(als_data_simple$sem_class_subj_f) > 0]
othervec_PP_int_als <- names(summary(als_data_simple$sem_class_PP_int_f))[summary(als_data_simple$sem_class_PP_int_f) > 0 & ! names(summary(als_data_simple$sem_class_PP_int_f)) %in% c("abstract_obj,locative", "human,abstract_obj")]
```

### Overview
```{r}
als_overview_summary <- 
  als_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_als, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_als, sem_class_subj, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_als, sem_class_PP_int, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short, sem_class_PP_int_f_short) %>% 
  summarise(count = n()) %>%
  ungroup() %>%
  transmute(subject = factor(sem_class_subj_f_short),
            internal_argument = factor(sem_class_PP_int_f_short),
            interpretation_int_arg = factor(interpr_sem_class_PP_int_f_short),
            count = count) %>%
  pivot_longer(c(subject, internal_argument, interpretation_int_arg), names_to = "NP", values_to = "semantics") %>%
    group_by(NP, semantics) %>%
    summarise(share = sum(count)/nrow(als_data_simple)) %>%
    mutate(semantics = factor(semantics, c("other", "ambiguous", "anim_proxy", 
                                           "human", "concrete_obj", "abstract_obj", 
                                           "abstract_obj,event", "abstract_obj,event(action)",
                                           "event", "event(action)", "property")))

ggplot(als_overview_summary, aes(x = NP, y = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = NULL, y = "Frequency", fill = NULL)+
  scale_fill_manual(values = colour_codes) +
  theme(legend.position = "bottom", legend.key.size = unit(10, "pt")) 

#ggsave("als_overview.png", device = "png", width = 18.5, height = 11, units = "cm")
```

```{r}
ggplot(als_overview_summary, aes(y = semantics, x = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "share", y = "Semantics", fill = NULL) +
  facet_wrap(vars(NP)) +
  theme_bw() +
  theme(strip.text = element_text(size = 8),
        strip.clip = "off",
        strip.background = element_rect(fill = "white", linewidth = 0),
        axis.text = element_text(size = 7)) +
  scale_fill_viridis_d() +
  guides(fill = "none") +
  scale_x_continuous(limits = c(0, 0.75))

#ggsave("als_overview.png", device = "png", width = 11.5, height = 9, units = "cm")
```

### Utterance and (part of) piece of art
```{r}
als_ut_popo_summary <- 
  als_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_als, interpr_sem_class_PP_int, "other"),
         ut_popoa = if_else(utterance & popoart, "utterance & (part of) piece of art",
                            if_else(utterance & ! popoart, "utterance",
                            if_else(! utterance & popoart, "(part of) piece of art",
                            " ")))) %>%
  group_by(interpr_sem_class_PP_int_f_short, ut_popoa) %>% 
  summarise(count = n())

ggplot(als_ut_popo_summary, aes(x = interpr_sem_class_PP_int_f_short, y = count, fill = ut_popoa)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Interp. int. arg.", y = "Frequency", fill = NULL) +
  theme(axis.text.x = element_text(angle = 90))
```


### Interpretation by subject
```{r}
als_subj_int_summary <- 
  als_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_als, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_als, sem_class_subj, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(als_subj_int_summary, aes(x = count, y = sem_class_subj_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Subject", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Semantic class int. arg. and interpretation

```{r}
als_PP_int_int_summary <- 
  als_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_als, interpr_sem_class_PP_int, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_als, sem_class_PP_int, "other")) %>%
  group_by(sem_class_PP_int_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(als_PP_int_int_summary, aes(x = count, y = sem_class_PP_int_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "sem. class int. arg.", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)

sankey_als_PP_int_int_summary <- als_PP_int_int_summary %>%
  mutate(interpr_sem_class_PP_int_f_short = str_c("  ", interpr_sem_class_PP_int_f_short, sep = ""))

#plot(gvisSankey(sankey_als_PP_int_int_summary, from = "sem_class_PP_int_f_short", to = "interpr_sem_class_PP_int_f_short", weight = "count", options = list(height = 400, width = 600, sankey = "{link: { colorMode: 'source'}, tooltip: { textStyle: { fontName: 'Linux Libertine O', fontSize: 12 } }, node: { label: { fontName: 'Linux Libertine O', fontSize: 12 }, nodePadding: 7, interactivity: false } }")))
```

## An

```{r}
an_data_simple <- simple_cases %>%
  filter(Stimulus_PP == "an")

an_data_general <- annotations %>%
  filter(Stimulus_PP == "an")

othervec_int_an <- names(summary(an_data_simple$interpr_sem_class_PP_int_f))[summary(an_data_simple$interpr_sem_class_PP_int_f) > 0 & ! names(summary(an_data_simple$interpr_sem_class_PP_int_f)) %in% c("locative,abstract_obj", "abstract_obj,human", "abstract_obj,locative", "property,human", "abstract_obj,concrete_obj", "event(action),abstract_obj", "temporal")]
othervec_subj_an <- names(summary(an_data_simple$sem_class_subj_f))[summary(an_data_simple$sem_class_subj_f) > 0 & ! names(summary(an_data_simple$sem_class_subj_f)) %in% c("locative,abstract_obj", "abstract_obj,human", "abstract_obj,locative", "property,human", "abstract_obj,concrete_obj", "event(action),abstract_obj", "temporal", "abstract_obj,event,state", "abstract_obj,state", "event(action),property", "property,ambiguous", "property,abstract_obj")]
othervec_PP_int_an <- names(summary(an_data_simple$sem_class_PP_int_f))[summary(an_data_simple$sem_class_PP_int_f) > 0 & ! names(summary(an_data_simple$sem_class_PP_int_f)) %in% c("locative,abstract_obj", "abstract_obj,human", "abstract_obj,locative", "property,human", "abstract_obj,concrete_obj", "event(action),abstract_obj", "temporal", "	
locative,concrete_obj", "locative,concrete_obj")]
```

### Overview
```{r}
an_overview_summary <- 
  an_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_an, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_an, sem_class_subj, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_an, sem_class_PP_int, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short, sem_class_PP_int_f_short) %>% 
  summarise(count = n()) %>%
  ungroup() %>%
  transmute(subject = factor(sem_class_subj_f_short),
            internal_argument = factor(sem_class_PP_int_f_short),
            interpretation_int_arg = factor(interpr_sem_class_PP_int_f_short),
            count = count) %>%
  pivot_longer(c(subject, internal_argument, interpretation_int_arg), names_to = "NP", values_to = "semantics") %>%
    group_by(NP, semantics) %>%
    summarise(share = sum(count)/nrow(an_data_simple)) %>%
    mutate(semantics = factor(semantics, c("other", "ambiguous", "anim_proxy", 
                                           "human", "concrete_obj", "locative", "abstract_obj", 
                                           "abstract_obj,event(action)",
                                           "abstract_obj,property",
                                           "event", "event(action)", "property")))

ggplot(an_overview_summary, aes(x = NP, y = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = NULL, y = "Frequency", fill = NULL) +
  theme(legend.position = "bottom", legend.key.size = unit(10, "pt")) +
  scale_fill_manual(values = colour_codes)

#ggsave("an_overview.png", device = "png", width = 18.5, height = 11, units = "cm")
```

```{r}
ggplot(an_overview_summary, aes(y = semantics, x = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "share", y = "Semantics", fill = NULL) +
  facet_wrap(vars(NP)) +
  theme_bw() +
  theme(strip.text = element_text(size = 8),
        strip.clip = "off",
        strip.background = element_rect(fill = "white", linewidth = 0),
        axis.text = element_text(size = 7)) +
  scale_fill_viridis_d() +
  guides(fill = "none") +
  scale_x_continuous(limits = c(0, 0.75))

#ggsave("an_overview.png", device = "png", width = 11.5, height = 9, units = "cm")
```

### Utterance and (part of) piece of art
```{r}
an_ut_popo_summary <- 
  an_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_an, interpr_sem_class_PP_int, "other"),
         ut_popoa = if_else(utterance & popoart, "utterance & (part of) piece of art",
                            if_else(utterance & ! popoart, "utterance",
                            if_else(! utterance & popoart, "(part of) piece of art",
                            " ")))) %>%
  group_by(interpr_sem_class_PP_int_f_short, ut_popoa) %>% 
  summarise(count = n())

ggplot(an_ut_popo_summary, aes(x = interpr_sem_class_PP_int_f_short, y = count, fill = ut_popoa)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Interpr. int. arg.", y = "Freq.", fill = NULL) +
  theme(axis.text.x = element_text(angle = 90))
```


### Interpretation by subject
```{r}
an_subj_int_summary <- 
  an_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_an, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_an, sem_class_subj, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(an_subj_int_summary, aes(x = count, y = sem_class_subj_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Subject", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Semantic class int. arg. and interpretation

```{r}
an_PP_int_int_summary <- 
  an_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_an, interpr_sem_class_PP_int, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_an, sem_class_PP_int, "other")) %>%
  group_by(sem_class_PP_int_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(an_PP_int_int_summary, aes(x = count, y = sem_class_PP_int_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "sen. class PP int.", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)

sankey_an_PP_int_int_summary <- an_PP_int_int_summary %>%
  mutate(interpr_sem_class_PP_int_f_short = str_c("  ", interpr_sem_class_PP_int_f_short, sep = ""))

#plot(gvisSankey(sankey_an_PP_int_int_summary, from = "sem_class_PP_int_f_short", to = "interpr_sem_class_PP_int_f_short", weight = "count", options = list(height = 400, width = 600, sankey = "{link: { colorMode: 'source'}, tooltip: { textStyle: { fontName: 'Linux Libertine O', fontSize: 12 } }, node: { label: { fontName: 'Linux Libertine O', fontSize: 12 }, nodePadding: 7, interactivity: false } }")))
```


## Bei

```{r}
bei_data_simple <- simple_cases %>%
  filter(Stimulus_PP == "bei")

bei_data_general <- annotations %>%
  filter(Stimulus_PP == "bei")

othervec_int_bei <- names(summary(bei_data_simple$interpr_sem_class_PP_int_f))[summary(bei_data_simple$interpr_sem_class_PP_int_f) > 0]
othervec_subj_bei <- names(summary(bei_data_simple$sem_class_subj_f))[summary(bei_data_simple$sem_class_subj_f) > 0]
othervec_PP_int_bei <- names(summary(bei_data_simple$sem_class_PP_int_f))[summary(bei_data_simple$sem_class_PP_int_f) > 0]
```

### Overview
```{r}
bei_overview_summary <- 
  bei_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_bei, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_bei, sem_class_subj, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_bei, sem_class_PP_int, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short, sem_class_PP_int_f_short) %>% 
  summarise(count = n()) %>%
  ungroup() %>%
  transmute(subject = factor(sem_class_subj_f_short),
            internal_argument = factor(sem_class_PP_int_f_short),
            interpretation_int_arg = factor(interpr_sem_class_PP_int_f_short),
            count = count) %>%
  pivot_longer(c(subject, internal_argument, interpretation_int_arg), names_to = "NP", values_to = "semantics") %>%
    group_by(NP, semantics) %>%
    summarise(share = sum(count)/nrow(bei_data_simple)) %>%
    mutate(semantics = factor(semantics, c("other", "ambiguous", "anim_proxy", 
                                           "human", "concrete_obj", "locative", "abstract_obj",
                                           "abstract_obj,concrete_obj",
                                           "abstract_obj,event", "abstract_obj,event(action)",
                                           "event", "event(action)", "property")))

ggplot(bei_overview_summary, aes(x = NP, y = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = NULL, y = "Frequency", fill = NULL) +
  theme(legend.position = "bottom", legend.key.size = unit(10, "pt")) +
  scale_fill_manual(values = colour_codes)

#ggsave("bei_overview.png", device = "png", width = 18.5, height = 11, units = "cm")
```

```{r}
ggplot(bei_overview_summary, aes(y = semantics, x = share, fill = semantics)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "share", y = "Semantics", fill = NULL) +
  facet_wrap(vars(NP)) +
  theme_bw() +
  theme(strip.text = element_text(size = 8),
        strip.clip = "off",
        strip.background = element_rect(fill = "white", linewidth = 0),
        axis.text = element_text(size = 7)) +
  scale_fill_viridis_d() +
  guides(fill = "none") +
  scale_x_continuous(limits = c(0, 0.75))

#ggsave("bei_overview.png", device = "png", width = 11.5, height = 9, units = "cm")
```

### Utterance and (part of) piece of art
```{r}
bei_ut_popo_summary <- 
  bei_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_bei, interpr_sem_class_PP_int, "other"),
         ut_popoa = if_else(utterance & popoart, "utterance & (part of) piece of art",
                            if_else(utterance & ! popoart, "utterance",
                            if_else(! utterance & popoart, "(part of) piece of art",
                            " ")))) %>%
  group_by(interpr_sem_class_PP_int_f_short, ut_popoa) %>% 
  summarise(count = n())

ggplot(bei_ut_popo_summary, aes(x = interpr_sem_class_PP_int_f_short, y = count, fill = ut_popoa)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Interpr. int. arg.", y = "Freq.", fill = NULL) +
  theme(axis.text.x = element_text(angle = 90))
```


### Interpretation by subject
```{r}
bei_subj_int_summary <- 
  bei_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_bei, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_bei, sem_class_subj, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(bei_subj_int_summary, aes(x = count, y = sem_class_subj_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Subject", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Semantic class int. arg. and interpretation

```{r}
bei_PP_int_int_summary <- 
  bei_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_bei, interpr_sem_class_PP_int, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_bei, sem_class_PP_int, "other")) %>%
  group_by(sem_class_PP_int_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(bei_PP_int_int_summary, aes(x = count, y = sem_class_PP_int_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "sen. class PP int.", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)

sankey_bei_PP_int_int_summary <- bei_PP_int_int_summary %>%
  mutate(interpr_sem_class_PP_int_f_short = str_c("  ", interpr_sem_class_PP_int_f_short, sep = ""))

#plot(gvisSankey(sankey_an_PP_int_int_summary, from = "sem_class_PP_int_f_short", to = "interpr_sem_class_PP_int_f_short", weight = "count", options = list(height = 400, width = 600, sankey = "{link: { colorMode: 'source'}, tooltip: { textStyle: { fontName: 'Linux Libertine O', fontSize: 12 } }, node: { label: { fontName: 'Linux Libertine O', fontSize: 12 }, nodePadding: 7, interactivity: false } }")))
```

## In

```{r}
in_data_simple <- simple_cases %>%
  filter(Stimulus_PP == "in")

in_data_general <- annotations %>%
  filter(Stimulus_PP == "in")

othervec_int_in <- names(summary(in_data_simple$interpr_sem_class_PP_int_f))[summary(in_data_simple$interpr_sem_class_PP_int_f) > 0]
othervec_subj_in <- names(summary(in_data_simple$sem_class_subj_f))[summary(in_data_simple$sem_class_subj_f) > 0]
othervec_PP_int_in <- names(summary(in_data_simple$sem_class_PP_int_f))[summary(in_data_simple$sem_class_PP_int_f) > 0]
```

### Overview
```{r}
in_overview_summary <- 
  in_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_in, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_in, sem_class_subj, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_in, sem_class_PP_int, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short, sem_class_PP_int_f_short) %>% 
  summarise(count = n()) %>%
  ungroup() %>%
  transmute(subject = factor(sem_class_subj_f_short),
            PP_int_arg = factor(sem_class_PP_int_f_short),
            interpretation = factor(interpr_sem_class_PP_int_f_short),
            count = count) %>%
  pivot_longer(c(subject, PP_int_arg, interpretation), names_to = "NP", values_to = "semantics")

ggplot(in_overview_summary, aes(x = NP, y = count, fill = semantics)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = NULL, y = "Frequency", fill = NULL) +
  theme(legend.position = "bottom", legend.key.size = unit(10, "pt")) +
  scale_fill_manual(values = colour_codes)

#ggsave("in_overview.png", device = "png", width = 18.5, height = 11, units = "cm")
```

### Utterance and (part of) piece of art
```{r}
in_ut_popo_summary <- 
  in_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_in, interpr_sem_class_PP_int, "other"),
         ut_popoa = if_else(utterance & popoart, "utterance & (part of) piece of art",
                            if_else(utterance & ! popoart, "utterance",
                            if_else(! utterance & popoart, "(part of) piece of art",
                            " ")))) %>%
  group_by(interpr_sem_class_PP_int_f_short, ut_popoa) %>% 
  summarise(count = n())

ggplot(in_ut_popo_summary, aes(x = interpr_sem_class_PP_int_f_short, y = count, fill = ut_popoa)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Interpr. int. arg.", y = "Freq.", fill = NULL) +
  theme(axis.text.x = element_text(angle = 90))
```


### Interpretation by subject
```{r}
in_subj_int_summary <- 
  in_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_in, interpr_sem_class_PP_int, "other"),
         sem_class_subj_f_short = if_else(sem_class_subj %in% othervec_subj_in, sem_class_subj, "other")) %>%
  group_by(sem_class_subj_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(in_subj_int_summary, aes(x = count, y = sem_class_subj_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "Subject", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)
```

### Semantic class int. arg. and interpretation

```{r}
in_PP_int_int_summary <- 
  in_data_simple %>%
  mutate(interpr_sem_class_PP_int_f_short = if_else(interpr_sem_class_PP_int %in% othervec_int_in, interpr_sem_class_PP_int, "other"),
         sem_class_PP_int_f_short = if_else(sem_class_PP_int %in% othervec_PP_int_in, sem_class_PP_int, "other")) %>%
  group_by(sem_class_PP_int_f_short, interpr_sem_class_PP_int_f_short) %>% 
  summarise(count = n())


ggplot(in_PP_int_int_summary, aes(x = count, y = sem_class_PP_int_f_short, fill = interpr_sem_class_PP_int_f_short)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Frequency", y = "sen. class PP int.", fill = "Interpr. int. arg.") +
  theme(legend.position = "bottom", legend.key.size = unit(2, "pt")) +
  scale_fill_manual(values = colour_codes_inter)

sankey_in_PP_int_int_summary <- in_PP_int_int_summary %>%
  mutate(interpr_sem_class_PP_int_f_short = str_c("  ", interpr_sem_class_PP_int_f_short, sep = ""))

#plot(gvisSankey(sankey_an_PP_int_int_summary, from = "sem_class_PP_int_f_short", to = "interpr_sem_class_PP_int_f_short", weight = "count", options = list(height = 400, width = 600, sankey = "{link: { colorMode: 'source'}, tooltip: { textStyle: { fontName: 'Linux Libertine O', fontSize: 12 } }, node: { label: { fontName: 'Linux Libertine O', fontSize: 12 }, nodePadding: 7, interactivity: false } }")))
```